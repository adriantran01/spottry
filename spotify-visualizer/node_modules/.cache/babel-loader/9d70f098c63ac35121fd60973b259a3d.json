{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\LZN\\\\Processing\\\\SpotifyVisualizerReact\\\\SpotifyVisualizerReact\\\\spotify-visualizer\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\LZN\\\\Processing\\\\SpotifyVisualizerReact\\\\SpotifyVisualizerReact\\\\spotify-visualizer\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nexport default function sketch(p) {\n  function fetchData(accessToken) {\n    return new Promise(\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(resolve, reject) {\n        var results;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return fetch('https://api.spotify.com/v1/me/player', {\n                  headers: {\n                    'Authorization': 'Bearer ' + accessToken\n                  }\n                }).then(function (response) {\n                  return response.json();\n                }).then(function (data) {\n                  var id = data.item.id;\n                  return id;\n                });\n\n              case 3:\n                results = _context.sent;\n                return _context.abrupt(\"return\", resolve(results));\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                return _context.abrupt(\"return\", reject(_context.t0));\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 7]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  function getURLParams(req) {\n    var uri = window.location.href;\n    var url = new URL(uri);\n    var res = url.searchParams.get(req);\n    return res;\n  }\n\n  function getAudioFeatures(id, access_token) {\n    return new Promise(\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(resolve, reject) {\n        var apiURL, song_id, fetchURL, results;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                apiURL = 'https://api.spotify.com/v1/audio-features/';\n                console.log(apiURL);\n                song_id = id;\n                fetchURL = apiURL.concat(song_id);\n                console.log(fetchURL);\n                _context2.next = 8;\n                return fetch(fetchURL, {\n                  headers: {\n                    \"Accept\": \"application/json\",\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": \"Bearer\" + access_token\n                  }\n                }).then(function (response) {\n                  return response.json();\n                }).then(function (data) {\n                  var audioAnalysis = [];\n                  audioAnalysis.push({\n                    \"BPM\": data.tempo,\n                    \"danceability\": data.danceability\n                  });\n                  return audioAnalysis;\n                });\n\n              case 8:\n                results = _context2.sent;\n                return _context2.abrupt(\"return\", resolve(results));\n\n              case 12:\n                _context2.prev = 12;\n                _context2.t0 = _context2[\"catch\"](0);\n                return _context2.abrupt(\"return\", reject(_context2.t0));\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 12]]);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n  }\n\n  function doEverything() {\n    return _doEverything.apply(this, arguments);\n  }\n\n  function _doEverything() {\n    _doEverything = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var access_token, id, audioAnalysis;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return getURLParams(\"access_token\");\n\n            case 2:\n              access_token = _context3.sent;\n              _context3.next = 5;\n              return fetchData(access_token);\n\n            case 5:\n              id = _context3.sent;\n              _context3.next = 8;\n              return getAudioFeatures(id, access_token);\n\n            case 8:\n              audioAnalysis = _context3.sent;\n              console.log(id);\n              return _context3.abrupt(\"return\", audioAnalysis);\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n    return _doEverything.apply(this, arguments);\n  }\n\n  var audioAnalysis = doEverything();\n  console.log(audioAnalysis);\n  var diameter;\n  var test = {\n    \"BPM\": 100\n  };\n\n  p.setup = function () {\n    p.createCanvas(p.windowWidth, p.windowHeight, p.P2D);\n    p.colorMode(p.HSB, 360, 100, 100);\n    p.noStroke();\n    p.ellipseMode(p.RADIUS);\n    p.frameRate(600);\n  };\n  /**\r\n   * draw function should take the audio analysis\r\n   * on every half beat (tatum) change circle radius\r\n   * have like a mild gradient from last radius to current radius \r\n   * change circle colour every beat\r\n   * change size according to volume\r\n   * beat circle to tempo from API\r\n   */\n\n\n  p.draw = function () {\n    p.clear();\n    var r = p.millis() / (1000 / (test.BPM / 60.0));\n    r -= p.int(r);\n    diameter = p.map(r, 0, 2.5, 400, 0); //map the bpm to diameter, and then change diameter each frame to increase/decrease based on tatums\n    // console.log(diameter)\n    // *slightly* slow down the seizure-inducing radial gradient effects\n\n    for (var i = 0; i < 7; i++) {\n      p.drawGradient(p.windowWidth / 2, p.windowHeight / 2);\n    }\n  };\n\n  p.getR = function (props) {\n    return props.tempo;\n  };\n\n  p.getDanceability = function (props) {\n    return props.danceability;\n  }; //makes it look like a speaker driver bouncing around in a weird way\n\n\n  p.drawGradient = function (x, y) {\n    var radius = diameter / 2;\n    var randColor = p.random(0, 360);\n\n    for (var r = radius; r > 0; --r) {\n      p.fill(200, randColor, 120); //blue\n\n      p.ellipse(x, y, r, r);\n      randColor = (randColor + 1) % 69; //tried random numbers until it looked good\n    }\n  };\n}","map":{"version":3,"sources":["D:\\LZN\\Processing\\SpotifyVisualizerReact\\SpotifyVisualizerReact\\spotify-visualizer\\src\\views\\js\\sketch.js"],"names":["sketch","p","fetchData","accessToken","Promise","resolve","reject","fetch","headers","then","response","json","data","id","item","results","getURLParams","req","uri","window","location","href","url","URL","res","searchParams","get","getAudioFeatures","access_token","apiURL","console","log","song_id","fetchURL","concat","audioAnalysis","push","tempo","danceability","doEverything","diameter","test","setup","createCanvas","windowWidth","windowHeight","P2D","colorMode","HSB","noStroke","ellipseMode","RADIUS","frameRate","draw","clear","r","millis","BPM","int","map","i","drawGradient","getR","props","getDanceability","x","y","radius","randColor","random","fill","ellipse"],"mappings":";;AAAA,eAAe,SAASA,MAAT,CAAgBC,CAAhB,EAAmB;AAE9B,WAASC,SAAT,CAAmBC,WAAnB,EAAgC;AAC5B,WAAO,IAAIC,OAAJ;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAY,iBAAOC,OAAP,EAAgBC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAGXC,KAAK,CAAC,sCAAD,EAAyC;AAC1CC,kBAAAA,OAAO,EAAE;AACL,qCAAiB,YAAYL;AADxB;AADiC,iBAAzC,CAAL,CAGGM,IAHH,CAGQ,UAAAC,QAAQ;AAAA,yBAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,iBAHhB,EAGqCF,IAHrC,CAG0C,UAAAG,IAAI,EAAI;AAC1C,sBAAIC,EAAE,GAAGD,IAAI,CAACE,IAAL,CAAUD,EAAnB;AACA,yBAAOA,EAAP;AACP,iBAND,CAHW;;AAAA;AAEPE,gBAAAA,OAFO;AAAA,iDAUJV,OAAO,CAACU,OAAD,CAVH;;AAAA;AAAA;AAAA;AAAA,iDAYJT,MAAM,aAZF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAZ;;AAAA;AAAA;AAAA;AAAA,QAAP;AAeH;;AAED,WAASU,YAAT,CAAsBC,GAAtB,EAA2B;AACvB,QAAIC,GAAG,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAA1B;AACA,QAAIC,GAAG,GAAG,IAAIC,GAAJ,CAAQL,GAAR,CAAV;AACA,QAAIM,GAAG,GAAGF,GAAG,CAACG,YAAJ,CAAiBC,GAAjB,CAAqBT,GAArB,CAAV;AACA,WAAOO,GAAP;AACH;;AAEL,WAASG,gBAAT,CAA0Bd,EAA1B,EAA8Be,YAA9B,EAA4C;AACxC,WAAO,IAAIxB,OAAJ;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAY,kBAAOC,OAAP,EAAgBC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPuB,gBAAAA,MAFO,GAEE,4CAFF;AAGXC,gBAAAA,OAAO,CAACC,GAAR,CAAYF,MAAZ;AACIG,gBAAAA,OAJO,GAIGnB,EAJH;AAKPoB,gBAAAA,QALO,GAKIJ,MAAM,CAACK,MAAP,CAAcF,OAAd,CALJ;AAMXF,gBAAAA,OAAO,CAACC,GAAR,CAAYE,QAAZ;AANW;AAAA,uBAQX1B,KAAK,CAAC0B,QAAD,EAAW;AACZzB,kBAAAA,OAAO,EAAE;AACL,8BAAU,kBADL;AAEL,oCAAgB,kBAFX;AAGL,qCAAiB,WAAWoB;AAHvB;AADG,iBAAX,CAAL,CAKOnB,IALP,CAKY,UAAAC,QAAQ;AAAA,yBAAIA,QAAQ,CAACC,IAAT,EAAJ;AAAA,iBALpB,EAKyCF,IALzC,CAK8C,UAAAG,IAAI,EAAI;AAC9C,sBAAIuB,aAAa,GAAG,EAApB;AACAA,kBAAAA,aAAa,CAACC,IAAd,CAAmB;AACf,2BAAOxB,IAAI,CAACyB,KADG;AAEf,oCAAgBzB,IAAI,CAAC0B;AAFN,mBAAnB;AAIA,yBAAOH,aAAP;AACH,iBAZL,CARW;;AAAA;AAOPpB,gBAAAA,OAPO;AAAA,kDAqBAV,OAAO,CAACU,OAAD,CArBP;;AAAA;AAAA;AAAA;AAAA,kDAuBAT,MAAM,cAvBN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAZ;;AAAA;AAAA;AAAA;AAAA,QAAP;AA0BC;;AAtD6B,WA2DnBiC,YA3DmB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,6BA2DlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAC6BvB,YAAY,CAAC,cAAD,CADzC;;AAAA;AACQY,cAAAA,YADR;AAAA;AAAA,qBAEmB1B,SAAS,CAAC0B,YAAD,CAF5B;;AAAA;AAEQf,cAAAA,EAFR;AAAA;AAAA,qBAG8Bc,gBAAgB,CAACd,EAAD,EAAKe,YAAL,CAH9C;;AAAA;AAGQO,cAAAA,aAHR;AAIIL,cAAAA,OAAO,CAACC,GAAR,CAAYlB,EAAZ;AAJJ,gDAKWsB,aALX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA3DkC;AAAA;AAAA;;AAmElC,MAAIA,aAAa,GAAGI,YAAY,EAAhC;AACAT,EAAAA,OAAO,CAACC,GAAR,CAAYI,aAAZ;AAEA,MAAIK,QAAJ;AAEA,MAAMC,IAAI,GAAG;AACT,WAAO;AADE,GAAb;;AAIAxC,EAAAA,CAAC,CAACyC,KAAF,GAAU,YAAW;AACjBzC,IAAAA,CAAC,CAAC0C,YAAF,CAAe1C,CAAC,CAAC2C,WAAjB,EAA8B3C,CAAC,CAAC4C,YAAhC,EAA8C5C,CAAC,CAAC6C,GAAhD;AACA7C,IAAAA,CAAC,CAAC8C,SAAF,CAAY9C,CAAC,CAAC+C,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,GAA7B;AACA/C,IAAAA,CAAC,CAACgD,QAAF;AACAhD,IAAAA,CAAC,CAACiD,WAAF,CAAcjD,CAAC,CAACkD,MAAhB;AACAlD,IAAAA,CAAC,CAACmD,SAAF,CAAY,GAAZ;AACH,GAND;AASA;;;;;;;;;;AAQAnD,EAAAA,CAAC,CAACoD,IAAF,GAAS,YAAW;AAChBpD,IAAAA,CAAC,CAACqD,KAAF;AACA,QAAIC,CAAC,GAAGtD,CAAC,CAACuD,MAAF,MAAc,QAAQf,IAAI,CAACgB,GAAL,GAAW,IAAnB,CAAd,CAAR;AACAF,IAAAA,CAAC,IAAItD,CAAC,CAACyD,GAAF,CAAMH,CAAN,CAAL;AACAf,IAAAA,QAAQ,GAAGvC,CAAC,CAAC0D,GAAF,CAAMJ,CAAN,EAAQ,CAAR,EAAU,GAAV,EAAc,GAAd,EAAkB,CAAlB,CAAX,CAJgB,CAIiB;AACjC;AACA;;AACA,SAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB3D,MAAAA,CAAC,CAAC4D,YAAF,CAAe5D,CAAC,CAAC2C,WAAF,GAAc,CAA7B,EAAgC3C,CAAC,CAAC4C,YAAF,GAAe,CAA/C;AACH;AACJ,GAVD;;AAYA5C,EAAAA,CAAC,CAAC6D,IAAF,GAAS,UAASC,KAAT,EAAgB;AACrB,WAAOA,KAAK,CAAC1B,KAAb;AACH,GAFD;;AAIApC,EAAAA,CAAC,CAAC+D,eAAF,GAAoB,UAASD,KAAT,EAAgB;AAChC,WAAOA,KAAK,CAACzB,YAAb;AACH,GAFD,CA7GkC,CAiHlC;;;AACArC,EAAAA,CAAC,CAAC4D,YAAF,GAAiB,UAASI,CAAT,EAAYC,CAAZ,EAAe;AAC5B,QAAIC,MAAM,GAAG3B,QAAQ,GAAG,CAAxB;AACA,QAAI4B,SAAS,GAAGnE,CAAC,CAACoE,MAAF,CAAS,CAAT,EAAY,GAAZ,CAAhB;;AACA,SAAK,IAAId,CAAC,GAAGY,MAAb,EAAqBZ,CAAC,GAAG,CAAzB,EAA4B,EAAEA,CAA9B,EAAiC;AAC7BtD,MAAAA,CAAC,CAACqE,IAAF,CAAO,GAAP,EAAYF,SAAZ,EAAuB,GAAvB,EAD6B,CACA;;AAC7BnE,MAAAA,CAAC,CAACsE,OAAF,CAAUN,CAAV,EAAaC,CAAb,EAAgBX,CAAhB,EAAmBA,CAAnB;AACAa,MAAAA,SAAS,GAAG,CAACA,SAAS,GAAG,CAAb,IAAkB,EAA9B,CAH6B,CAGK;AACjC;AACJ,GARL;AASC","sourcesContent":["export default function sketch(p) {\r\n\r\n    function fetchData(accessToken) {\r\n        return new Promise(async (resolve, reject) => {\r\n            try {\r\n                let results = await\r\n                fetch('https://api.spotify.com/v1/me/player', {\r\n                    headers: {\r\n                        'Authorization': 'Bearer ' + accessToken}\r\n                }).then(response => response.json()).then(data => {\r\n                        let id = data.item.id\r\n                        return id;\r\n                })\r\n                return resolve(results);\r\n            } catch (e) {\r\n                return reject(e);\r\n            }\r\n        })\r\n    }  \r\n\r\n    function getURLParams(req) {\r\n        var uri = window.location.href;\r\n        var url = new URL(uri);\r\n        var res = url.searchParams.get(req);\r\n        return res\r\n    }\r\n\r\nfunction getAudioFeatures(id, access_token) {\r\n    return new Promise(async (resolve, reject) => {\r\n        try {\r\n            let apiURL = 'https://api.spotify.com/v1/audio-features/'\r\n            console.log(apiURL)\r\n            let song_id = id;\r\n            let fetchURL = apiURL.concat(song_id);\r\n            console.log(fetchURL);\r\n            let results = await \r\n            fetch(fetchURL, {\r\n                headers: {\r\n                    \"Accept\": \"application/json\",\r\n                    \"Content-Type\": \"application/json\",\r\n                    \"Authorization\": \"Bearer\" + access_token}\r\n                }).then(response => response.json()).then(data => {\r\n                    let audioAnalysis = [];\r\n                    audioAnalysis.push({\r\n                        \"BPM\": data.tempo,\r\n                        \"danceability\": data.danceability\r\n                    })\r\n                    return audioAnalysis;\r\n                })\r\n                return resolve(results)\r\n            } catch (e) {\r\n                return reject(e);\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n\r\n\r\nasync function doEverything() {\r\n    let access_token = await getURLParams(\"access_token\");\r\n    let id = await fetchData(access_token);\r\n    let audioAnalysis = await getAudioFeatures(id, access_token);\r\n    console.log(id);\r\n    return audioAnalysis;\r\n}\r\n\r\nvar audioAnalysis = doEverything();\r\nconsole.log(audioAnalysis);\r\n\r\nvar diameter;\r\n\r\nconst test = {\r\n    \"BPM\": 100,\r\n}\r\n\r\np.setup = function() {\r\n    p.createCanvas(p.windowWidth, p.windowHeight, p.P2D);\r\n    p.colorMode(p.HSB, 360, 100, 100);\r\n    p.noStroke();\r\n    p.ellipseMode(p.RADIUS);\r\n    p.frameRate(600);\r\n}\r\n\r\n\r\n/**\r\n * draw function should take the audio analysis\r\n * on every half beat (tatum) change circle radius\r\n * have like a mild gradient from last radius to current radius \r\n * change circle colour every beat\r\n * change size according to volume\r\n * beat circle to tempo from API\r\n */\r\np.draw = function() {\r\n    p.clear();\r\n    var r = p.millis() / (1000 / (test.BPM / 60.0));\r\n    r -= p.int(r);\r\n    diameter = p.map(r,0,2.5,400,0); //map the bpm to diameter, and then change diameter each frame to increase/decrease based on tatums\r\n    // console.log(diameter)\r\n    // *slightly* slow down the seizure-inducing radial gradient effects\r\n    for (var i = 0; i < 7; i++) {\r\n        p.drawGradient(p.windowWidth/2, p.windowHeight/2)    \r\n    }\r\n}\r\n\r\np.getR = function(props) {\r\n    return props.tempo\r\n}\r\n\r\np.getDanceability = function(props) {\r\n    return props.danceability\r\n}\r\n\r\n//makes it look like a speaker driver bouncing around in a weird way\r\np.drawGradient = function(x, y) {\r\n    var radius = diameter / 2;\r\n    var randColor = p.random(0, 360);\r\n    for (var r = radius; r > 0; --r) {\r\n        p.fill(200, randColor, 120); //blue\r\n        p.ellipse(x, y, r, r);\r\n        randColor = (randColor + 1) % 69; //tried random numbers until it looked good\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}
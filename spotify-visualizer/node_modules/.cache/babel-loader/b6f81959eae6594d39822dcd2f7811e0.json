{"ast":null,"code":"export default function sketch(p) {\n  function fetchData(accessToken) {\n    var _this = this;\n\n    fetch('https://api.spotify.com/v1/me/player', {\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(function (response) {\n      return response.json();\n    }).then(function (data) {\n      console.log(data);\n\n      _this.setState({\n        song: {\n          song_name: data.item.name,\n          artist: data.item.artists[0].name,\n          time: data.progress_ms * 100 / data.item.duration_ms,\n          //convert times in ms to progress in %\n          duration: data.item.duration_ms,\n          album_url: data.item.album.images[0].url\n        }\n      });\n\n      console.log(_this.state);\n      console.log(_this.state.song);\n    });\n  }\n\n  var analysis = {};\n  var features = {};\n  var diameter;\n  var test = {\n    \"BPM\": 100\n  };\n\n  p.setup = function () {\n    p.createCanvas(p.windowWidth, p.windowHeight, p.P2D);\n    p.colorMode(p.HSB, 360, 100, 100);\n    p.noStroke();\n    p.ellipseMode(p.RADIUS);\n    p.frameRate(600);\n  };\n  /**\r\n   * draw function should take the audio analysis\r\n   * on every half beat (tatum) change circle radius\r\n   * have like a mild gradient from last radius to current radius \r\n   * change circle colour every beat\r\n   * change size according to volume\r\n   * beat circle to tempo from API\r\n   */\n\n\n  p.draw = function () {\n    p.clear();\n    var r = p.millis() / (1000 / (test.BPM / 60.0));\n    r -= p.int(r);\n    diameter = p.map(r, 0, 2.5, 400, 0); //map the bpm to diameter, and then change diameter each frame to increase/decrease based on tatums\n\n    console.log(diameter); // *slightly* slow down the seizure-inducing radial gradient effects\n\n    for (var i = 0; i < 7; i++) {\n      p.drawGradient(p.windowWidth / 2, p.windowHeight / 2);\n    }\n  };\n\n  p.getR = function (props) {\n    return props.tempo;\n  };\n\n  p.getDanceability = function (props) {\n    return props.danceability;\n  }; //makes it look like a speaker driver bouncing around in a weird way\n\n\n  p.drawGradient = function (x, y) {\n    var radius = diameter / 2;\n    var randColor = p.random(0, 360);\n\n    for (var r = radius; r > 0; --r) {\n      p.fill(200, randColor, 120); //blue\n\n      p.ellipse(x, y, r, r);\n      randColor = (randColor + 1) % 69; //tried random numbers until it looked good\n    }\n  };\n}","map":{"version":3,"sources":["D:\\LZN\\Processing\\SpotifyVisualizerReact\\SpotifyVisualizerReact\\spotify-visualizer\\src\\views\\js\\sketch.js"],"names":["sketch","p","fetchData","accessToken","fetch","headers","then","response","json","data","console","log","setState","song","song_name","item","name","artist","artists","time","progress_ms","duration_ms","duration","album_url","album","images","url","state","analysis","features","diameter","test","setup","createCanvas","windowWidth","windowHeight","P2D","colorMode","HSB","noStroke","ellipseMode","RADIUS","frameRate","draw","clear","r","millis","BPM","int","map","i","drawGradient","getR","props","tempo","getDanceability","danceability","x","y","radius","randColor","random","fill","ellipse"],"mappings":"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","sourcesContent":["export default function sketch(p) {\r\n\r\n    function fetchData(accessToken) {\r\n        fetch('https://api.spotify.com/v1/me/player', {\r\n                        headers: {\r\n                            'Authorization': 'Bearer ' + accessToken}\r\n                    }).then(response => response.json()).then(data => {\r\n                            console.log(data);\r\n                            this.setState({\r\n                                song: {                    \r\n                                    song_name: data.item.name,\r\n                                    artist: data.item.artists[0].name,\r\n                                    time: (data.progress_ms*100)/data.item.duration_ms, //convert times in ms to progress in %\r\n                                    duration: data.item.duration_ms,\r\n                                    album_url: data.item.album.images[0].url\r\n                                }             \r\n                        });\r\n                        console.log(this.state);\r\n                        console.log(this.state.song);\r\n                    })\r\n        }    \r\n\r\nlet analysis = {};\r\nlet features = {};\r\nvar diameter;\r\n\r\nconst test = {\r\n    \"BPM\": 100,\r\n}\r\n\r\np.setup = function() {\r\n    p.createCanvas(p.windowWidth, p.windowHeight, p.P2D);\r\n    p.colorMode(p.HSB, 360, 100, 100);\r\n    p.noStroke();\r\n    p.ellipseMode(p.RADIUS);\r\n    p.frameRate(600);\r\n}\r\n\r\n\r\n/**\r\n * draw function should take the audio analysis\r\n * on every half beat (tatum) change circle radius\r\n * have like a mild gradient from last radius to current radius \r\n * change circle colour every beat\r\n * change size according to volume\r\n * beat circle to tempo from API\r\n */\r\np.draw = function() {\r\n    p.clear();\r\n    var r = p.millis() / (1000 / (test.BPM / 60.0));\r\n    r -= p.int(r);\r\n    diameter = p.map(r,0,2.5,400,0); //map the bpm to diameter, and then change diameter each frame to increase/decrease based on tatums\r\n    console.log(diameter)\r\n    // *slightly* slow down the seizure-inducing radial gradient effects\r\n    for (var i = 0; i < 7; i++) {\r\n        p.drawGradient(p.windowWidth/2, p.windowHeight/2)    \r\n    }\r\n}\r\n\r\np.getR = function(props) {\r\n    return props.tempo\r\n}\r\n\r\np.getDanceability = function(props) {\r\n    return props.danceability\r\n}\r\n\r\n//makes it look like a speaker driver bouncing around in a weird way\r\np.drawGradient = function(x, y) {\r\n    var radius = diameter / 2;\r\n    var randColor = p.random(0, 360);\r\n    for (var r = radius; r > 0; --r) {\r\n        p.fill(200, randColor, 120); //blue\r\n        p.ellipse(x, y, r, r);\r\n        randColor = (randColor + 1) % 69; //tried random numbers until it looked good\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}